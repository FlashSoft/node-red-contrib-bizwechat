<script type="text/javascript">
RED.nodes.registerType('bizwechat-input', {
  category: '企业微信',
  color: '#7ac6cb',
  paletteLabel: '服务端',
  label () {
    return this.name || '服务端'
  },
  defaults: {
    name: {
      value: ''
    },
    bizwechat: {
      value: '',
      type: 'bizwechat-configurator'
    }
  },
  inputs: 0,
  outputs: 1,
  icon: 'white-globe.png'
})
RED.nodes.registerType('bizwechat-output', {
  category: '企业微信',
  color: '#7ac6cb',
  paletteLabel: '输出',
  label () {
    return this.name || '输出'
  },
  defaults: {
    name: {
      value: ''
    },
    bizwechat: {
      value: '',
      type: 'bizwechat-configurator'
    }

  },
  inputs: 1,
  outputs: 0,
  icon: 'white-globe.png',
  align: 'right'
})
RED.nodes.registerType('bizwechat-pushbear', {
  category: '企业微信',
  color: '#7ac6cb',
  paletteLabel: '推送',
  label () {
    return this.name || '推送'
  },
  defaults: {
    name: {
      value: ''
    },
    bizwechat: {
      value: '',
      type: 'bizwechat-configurator'
    },
    touser: {
      value: ''
    },

    toparty: {
      value: ''
    },

    title: {
      value: ''
    },

    description: {
      value: ''
    }

  },
  inputs: 1,
  outputs: 1,
  icon: 'white-globe.png'
})

RED.nodes.registerType('bizwechat-pushbear', {
  category: '企业微信',
  color: '#7ac6cb',
  paletteLabel: '推送',
  label () {
    return this.name || '推送'
  },
  defaults: {
    name: {
      value: ''
    },
    bizwechat: {
      value: '',
      type: 'bizwechat-configurator'
    },
    touser: {
      value: ''
    },
    toparty: {
      value: ''
    },
    title: {
      value: ''
    },
    description: {
      value: ''
    }
  },
  inputs: 1,
  outputs: 1,
  icon: 'white-globe.png'
})
</script>
<script type="text/x-red" data-template-name="bizwechat-input">
  <div class="form-row">
    <label for="node-input-bizwechat"><i class="icon-tag"></i>配置</label>
    <input type="text" id="node-input-bizwechat">
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="icon-tag"></i>名称</label>
    <input type="text" id="node-input-name">
  </div>
</script>
<script type="text/x-red" data-help-name="bizwechat-input">
  <p>企业微信服务器节点，用于接收企业微信发过来的消息</p>
  <p>接收到企业微信发布的消息必须在30s内回复，不然企业微信会重复发送三次防止失败</p>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>config
            <span class="property-type">object</span>
        </dt>
        <dd>服务器节点配置信息</dd>
        <dt class="message-properties">message
            <span class="property-type">object</span>
        </dt>
        <dd>企业微信发过来的消息</dd>
        <dl class="message-properties">
            <dt>ToUserName
                <span class="property-type">string</span>
            </dt>
            <dd>接收者账号</dd>
            <dt class="message-properties">FromUserName
                <span class="property-type">string</span>
            </dt>
            <dd>发送人账号</dd>
            <dt class="message-properties">CreateTime
                <span class="property-type">long</span>
            </dt>
            <dd>发送时间</dd>
            <dt class="message-properties">MsgType
                <span class="property-type">string</span>
            </dt>
            <dd>消息类型</dd>
            <dt class="message-properties">AgentID
                <span class="property-type">long</span>
            </dt>
            <dd>应用id</dd>
            <dd>消息类型</dd>
            <dt class="message-properties">Event
                <span class="property-type">long</span>
            </dt>
            <dd>事件类型</dd>
    
        </dl>
        <dt class="message-properties">req
            <span class="property-type">Object</span>
        </dt>
        <dd>http请求的request</dd>
        <dt class="message-properties">res
            <span class="property-type">Object</span>
        </dt>
        <dd>http请求的response</dd>

    </dl>
    
</script>

<script type="text/x-red" data-template-name="bizwechat-output">
  <div class="form-row">
    <label for="node-input-bizwechat"><i class="icon-tag"></i>配置</label>
    <input type="text" id="node-input-bizwechat">
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="icon-tag"></i>名称</label>
    <input type="text" id="node-input-name">
  </div>
</script>
<script type="text/x-red" data-help-name="bizwechat-output">
  <p>回复企业微信发布的信息</p>
    <h3>输入</h3>
    <p>其余输入信息参考<strong>服务器节点的输出</strong>，此节点只能是服务器节点的后续节点，且中间处理流程不能影响<strong>msg.res</strong>,否则造成消息无法回复</p>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">string</span>
        </dt>
        <dd>回复消息文本，文本为空即：'',则为响应企业微信</dd>
       
    </dl>
    
</script>

<script type="text/x-red" data-template-name="bizwechat-pushbear">
  <div class="form-row">
    <label for="node-input-bizwechat"><i class="icon-tag"></i>配置</label>
    <input type="text" id="node-input-bizwechat">
  </div>
  <div class="form-row">
    <label for="node-input-name"><i class="icon-tag"></i>名称</label>
    <input type="text" id="node-input-name">
  </div>
  <div class="form-row">
    <label for="node-input-touser"><i class="icon-tag"></i>接收者</label>
    <input type="text" id="node-input-touser" placeholder="接收者账号，多个使用|分割，不填写默认全部接收">
  </div>
  <div class="form-row">
    <label for="node-input-title"><i class="icon-tag"></i>标题</label>
    <input type="text" id="node-input-title" placeholder="发送信息的标题">
  </div>
  <div class="form-row">
    <label for="node-input-description"><i class="icon-tag"></i>内容</label>
    <textarea id="node-input-description" placeholder="发送信息的内容(MarkDown语法)" style="width: 70%; height:200px;"></textarea>
  </div>
</script>
<script type="text/x-red" data-help-name="bizwechat-pushbear">
    <p>推送信息到企业微信，目前仅支持卡片类型的消息</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">string</span>
        </dt>
        <dd>推送消息文本</dd>
        <dt class="optional">touser <span class="property-type">string</span>
        </dt>
        <dd>消息接收的用户，多个可以使用|分开，例如：xxx|xxx|xxx,不填写默认推送所有人</dd>

    </dl>
    <h3>输出</h3>
    <p>输入信心合并配置信息输出</p>

</script>
